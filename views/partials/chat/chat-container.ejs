<h3>Chat with support</h3>
<ul
  class="list-group list-group-flush"
  id="chat-list"
  style="height: 400px; overflow-y: scroll"
>
  <% messages.forEach(message => { %>
  <li class="list-group-item list-group-item-secondary mb-2">
    <div class="d-flex w-100 justify-content-between">
      <small class="mb-1"><%= message.email %></small>
      <small class="text-right"><%= message.date %></small>
    </div>
    <p class="mb-1"><%= message.text %></p>
  </li>
  <% }) %>
</ul>
<form secondary="/api/messages" method="post" id="message-form">
  <label>
    Email
    <input
      class="form-control"
      type="email"
      placeholder="Sign in with your email"
      name="email"
    />
  </label>
  <label>
    Message <input class="form-control" type="text placeholder="Leave your message"
    name="text" id="form-message">
  </label>
  <input class="btn btn-primary w-100" type="submit" value="Enviar" />
</form>

<script>
  const chatList = document.getElementById("chat-list");
  const messageForm = document.getElementById("message-form");
  const formInputMessage = document.getElementById('form-message');

  const addMessage = (message, client = false) => {
    const template = `<li id="${
      message.id + "/" + message.date
    }" class="list-group-item list-group-item-${
      client ? "primary" : "secondary"
    } mb-2">
    <div class="d-flex w-100 justify-content-between">
      <small class="mb-1">${message.email}</small>
      <small class="text-right">${message.date}</small>
    </div>
    <p class="mb-1">${message.text}</p>
  </li>`;

    chatList.innerHTML += template;
  };

  messageForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const message = Object.fromEntries(new FormData(e.target).entries());
    socket.emit('publish_message', message)
    formInputMessage.value = ''
  })

  socket.on("new_message", (message) => {
    addMessage(message);
  });


</script>
